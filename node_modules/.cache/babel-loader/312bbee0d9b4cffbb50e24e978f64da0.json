{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport { Transaction } from '@solana/web3.js';\nimport { createLoggerMiddleware, COMMUNICATION_JRPC_METHODS, COMMUNICATION_NOTIFICATIONS, PROVIDER_JRPC_METHODS, PROVIDER_NOTIFICATIONS } from '@toruslabs/base-controllers';\nimport { setAPIKey } from '@toruslabs/http-helpers';\nimport { SafeEventEmitter, ObjectMultiplex, createStreamMiddleware, JRPCEngine, createIdRemapMiddleware, getRpcPromiseCallback, BasePostMessageStream } from '@toruslabs/openlogin-jrpc';\nimport { ethErrors, EthereumRpcError } from 'eth-rpc-errors';\nimport { isDuplexStream } from 'is-stream';\nimport pump from 'pump';\nimport loglevel from 'loglevel';\nimport dequal from 'fast-deep-equal';\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\n\nfunction __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nvar messages = {\n  errors: {\n    disconnected: () => \"Torus: Lost connection to Torus.\",\n    permanentlyDisconnected: () => \"Torus: Disconnected from iframe. Page reload required.\",\n    unsupportedSync: method => `Torus: The Torus Ethereum provider does not support synchronous methods like ${method} without a callback parameter.`,\n    invalidDuplexStream: () => \"Must provide a Node.js-style duplex stream.\",\n    invalidOptions: maxEventListeners => `Invalid options. Received: { maxEventListeners: ${maxEventListeners}}`,\n    invalidRequestArgs: () => `Expected a single, non-array, object argument.`,\n    invalidRequestMethod: () => `'args.method' must be a non-empty string.`,\n    invalidRequestParams: () => `'args.params' must be an object or array if provided.`,\n    invalidLoggerObject: () => `'args.logger' must be an object if provided.`,\n    invalidLoggerMethod: method => `'args.logger' must include required method '${method}'.`\n  },\n  info: {\n    connected: chainId => `Torus: Connected to chain with ID \"${chainId}\".`\n  },\n  warnings: {}\n};\nconst PAYMENT_PROVIDER = {\n  MOONPAY: \"moonpay\",\n  WYRE: \"wyre\",\n  RAMPNETWORK: \"rampnetwork\",\n  XANPOOL: \"xanpool\",\n  MERCURYO: \"mercuryo\",\n  TRANSAK: \"transak\"\n};\nconst TORUS_BUILD_ENV = {\n  PRODUCTION: \"production\",\n  DEVELOPMENT: \"development\",\n  TESTING: \"testing\"\n};\nconst BUTTON_POSITION = {\n  BOTTOM_LEFT: \"bottom-left\",\n  TOP_LEFT: \"top-left\",\n  BOTTOM_RIGHT: \"bottom-right\",\n  TOP_RIGHT: \"top-right\"\n};\nconst LOGIN_PROVIDER = {\n  GOOGLE: \"google\",\n  FACEBOOK: \"facebook\",\n  REDDIT: \"reddit\",\n  DISCORD: \"discord\",\n  TWITCH: \"twitch\",\n  APPLE: \"apple\",\n  LINE: \"line\",\n  GITHUB: \"github\",\n  KAKAO: \"kakao\",\n  LINKEDIN: \"linkedin\",\n  TWITTER: \"twitter\",\n  WEIBO: \"weibo\",\n  WECHAT: \"wechat\",\n  EMAIL_PASSWORDLESS: \"email_passwordless\"\n};\nconst translations = {\n  en: {\n    embed: {\n      continue: \"Continue\",\n      actionRequired: \"Authorization required\",\n      pendingAction: \"Click continue to proceed with your request in a popup\",\n      cookiesRequired: \"Cookies Required\",\n      enableCookies: \"Please enable cookies in your browser preferences to access Torus\",\n      clickHere: \"More Info\"\n    }\n  },\n  de: {\n    embed: {\n      continue: \"Fortsetzen\",\n      actionRequired: \"Autorisierung erforderlich\",\n      pendingAction: \"Klicken Sie in einem Popup auf Weiter, um mit Ihrer Anfrage fortzufahren\",\n      cookiesRequired: \"Cookies benötigt\",\n      enableCookies: \"Bitte aktivieren Sie Cookies in Ihren Browsereinstellungen, um auf Torus zuzugreifen\",\n      clickHere: \"Mehr Info\"\n    }\n  },\n  ja: {\n    embed: {\n      continue: \"継続する\",\n      actionRequired: \"認証が必要です\",\n      pendingAction: \"続行をクリックして、ポップアップでリクエストを続行します\",\n      cookiesRequired: \"必要なクッキー\",\n      enableCookies: \"Torusにアクセスするには、ブラウザの設定でCookieを有効にしてください。\",\n      clickHere: \"詳しくは\"\n    }\n  },\n  ko: {\n    embed: {\n      continue: \"계속하다\",\n      actionRequired: \"승인 필요\",\n      pendingAction: \"팝업에서 요청을 진행하려면 계속을 클릭하십시오.\",\n      cookiesRequired: \"쿠키 필요\",\n      enableCookies: \"브라우저 환경 설정에서 쿠키를 활성화하여 Torus에 액세스하십시오.\",\n      clickHere: \"더 많은 정보\"\n    }\n  },\n  zh: {\n    embed: {\n      continue: \"继续\",\n      actionRequired: \"需要授权\",\n      pendingAction: \"单击继续以在弹出窗口中继续您的请求\",\n      cookiesRequired: \"必填Cookie\",\n      enableCookies: \"请在您的浏览器首选项中启用cookie以访问Torus。\",\n      clickHere: \"更多信息\"\n    }\n  }\n};\nvar configuration = {\n  supportedVerifierList: [LOGIN_PROVIDER.GOOGLE, LOGIN_PROVIDER.REDDIT, LOGIN_PROVIDER.DISCORD],\n  api: \"https://api.tor.us\",\n  translations,\n  prodTorusUrl: \"\",\n  localStorageKey: `torus-${window.location.hostname}`\n};\nvar log = loglevel.getLogger(\"solana-embed\"); // utility functions\n\n/**\n * json-rpc-engine middleware that logs RPC errors and and validates req.method.\n *\n * @param log - The logging API to use.\n * @returns  json-rpc-engine middleware function\n */\n\nfunction createErrorMiddleware() {\n  return (req, res, next) => {\n    // json-rpc-engine will terminate the request when it notices this error\n    if (typeof req.method !== \"string\" || !req.method) {\n      res.error = ethErrors.rpc.invalidRequest({\n        message: `The request 'method' must be a non-empty string.`,\n        data: req\n      });\n    }\n\n    next(done => {\n      const {\n        error\n      } = res;\n\n      if (!error) {\n        return done();\n      }\n\n      log.error(`Torus - RPC Error: ${error.message}`, error);\n      return done();\n    });\n  };\n}\n/**\n * Logs a stream disconnection error. Emits an 'error' if given an\n * EventEmitter that has listeners for the 'error' event.\n *\n * @param log - The logging API to use.\n * @param remoteLabel - The label of the disconnected stream.\n * @param error - The associated error to log.\n * @param emitter - The logging API to use.\n */\n\n\nfunction logStreamDisconnectWarning(remoteLabel, error, emitter) {\n  let warningMsg = `Torus: Lost connection to \"${remoteLabel}\".`;\n\n  if (error === null || error === void 0 ? void 0 : error.stack) {\n    warningMsg += `\\n${error.stack}`;\n  }\n\n  log.warn(warningMsg);\n\n  if (emitter && emitter.listenerCount(\"error\") > 0) {\n    emitter.emit(\"error\", warningMsg);\n  }\n}\n\nconst getWindowId = () => Math.random().toString(36).slice(2);\n\nconst getTorusUrl = buildEnv => __awaiter(void 0, void 0, void 0, function* () {\n  let torusUrl;\n  let logLevel; // const versionUsed = version;\n  // log.info(\"solana embed version used: \", versionUsed);\n\n  switch (buildEnv) {\n    case \"testing\":\n      torusUrl = \"https://solana-testing.tor.us\";\n      logLevel = \"debug\";\n      break;\n\n    case \"development\":\n      torusUrl = \"http://localhost:8080\";\n      logLevel = \"debug\";\n      break;\n\n    default:\n      torusUrl = `https://solana.tor.us`;\n      logLevel = \"error\";\n      break;\n  }\n\n  return {\n    torusUrl,\n    logLevel\n  };\n});\n\nconst getUserLanguage = () => {\n  let userLanguage = window.navigator.language || \"en-US\";\n  const userLanguages = userLanguage.split(\"-\");\n  userLanguage = Object.prototype.hasOwnProperty.call(configuration.translations, userLanguages[0]) ? userLanguages[0] : \"en\";\n  return userLanguage;\n};\n\nconst FEATURES_PROVIDER_CHANGE_WINDOW = {\n  height: 660,\n  width: 375\n};\nconst FEATURES_DEFAULT_WALLET_WINDOW = {\n  height: 740,\n  width: 1315\n};\nconst FEATURES_DEFAULT_POPUP_WINDOW = {\n  height: 700,\n  width: 1200\n};\nconst FEATURES_CONFIRM_WINDOW = {\n  height: 600,\n  width: 400\n};\n\nfunction storageAvailable(type) {\n  let storage;\n\n  try {\n    storage = window[type];\n    const x = \"__storage_test__\";\n    storage.setItem(x, x);\n    storage.removeItem(x);\n    return true;\n  } catch (e) {\n    return e && ( // everything except Firefox\n    e.code === 22 || // Firefox\n    e.code === 1014 || // test name field too, because code might not be present\n    // everything except Firefox\n    e.name === \"QuotaExceededError\" || // Firefox\n    e.name === \"NS_ERROR_DOM_QUOTA_REACHED\") && // acknowledge QuotaExceededError only if there's something already stored\n    storage && storage.length !== 0;\n  }\n}\n/**\n * popup handler utils\n */\n\n\nfunction getPopupFeatures({\n  width: w,\n  height: h\n}) {\n  // Fixes dual-screen position                             Most browsers      Firefox\n  const dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : window.screenX;\n  const dualScreenTop = window.screenTop !== undefined ? window.screenTop : window.screenY;\n  const width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : window.screen.width;\n  const height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : window.screen.height;\n  const systemZoom = 1; // No reliable estimate\n\n  const left = Math.abs((width - w) / 2 / systemZoom + dualScreenLeft);\n  const top = Math.abs((height - h) / 2 / systemZoom + dualScreenTop);\n  const features = `titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=${h / systemZoom},width=${w / systemZoom},top=${top},left=${left}`;\n  return features;\n}\n/**\n * @param {Object} connectionStream - A Node.js duplex stream\n * @param {Object} opts - An options bag\n * @param {number} opts.maxEventListeners - The maximum number of event listeners\n */\n\n\nclass BaseProvider extends SafeEventEmitter {\n  constructor(connectionStream, {\n    maxEventListeners = 100,\n    jsonRpcStreamName = \"provider\"\n  }) {\n    super();\n\n    if (!isDuplexStream(connectionStream)) {\n      throw new Error(messages.errors.invalidDuplexStream());\n    }\n\n    this.isTorus = true;\n    this.setMaxListeners(maxEventListeners);\n    this._handleConnect = this._handleConnect.bind(this);\n    this._handleDisconnect = this._handleDisconnect.bind(this);\n    this._handleStreamDisconnect = this._handleStreamDisconnect.bind(this);\n    this._rpcRequest = this._rpcRequest.bind(this);\n    this._initializeState = this._initializeState.bind(this);\n    this.request = this.request.bind(this);\n    this.sendAsync = this.sendAsync.bind(this); // this.enable = this.enable.bind(this);\n    // setup connectionStream multiplexing\n\n    const mux = new ObjectMultiplex();\n    pump(connectionStream, mux, connectionStream, this._handleStreamDisconnect.bind(this, \"Torus\")); // ignore phishing warning message (handled elsewhere)\n\n    mux.ignoreStream(\"phishing\"); // setup own event listeners\n    // connect to async provider\n\n    const jsonRpcConnection = createStreamMiddleware();\n    pump(jsonRpcConnection.stream, mux.createStream(jsonRpcStreamName), jsonRpcConnection.stream, this._handleStreamDisconnect.bind(this, \"Torus RpcProvider\")); // handle RPC requests via dapp-side rpc engine\n\n    const rpcEngine = new JRPCEngine();\n    rpcEngine.push(createIdRemapMiddleware());\n    rpcEngine.push(createErrorMiddleware());\n    rpcEngine.push(createLoggerMiddleware({\n      origin: location.origin\n    }));\n    rpcEngine.push(jsonRpcConnection.middleware);\n    this._rpcEngine = rpcEngine;\n    this.jsonRpcConnectionEvents = jsonRpcConnection.events;\n  }\n  /**\n   * Submits an RPC request for the given method, with the given params.\n   * Resolves with the result of the method call, or rejects on error.\n   *\n   * @param {Object} args - The RPC request arguments.\n   * @param {string} args.method - The RPC method name.\n   * @param {unknown[] | Object} [args.params] - The parameters for the RPC method.\n   * @returns {Promise<unknown>} A Promise that resolves with the result of the RPC method,\n   * or rejects if an error is encountered.\n   */\n\n\n  request(args) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!args || typeof args !== \"object\" || Array.isArray(args)) {\n        throw ethErrors.rpc.invalidRequest({\n          message: messages.errors.invalidRequestArgs(),\n          data: args\n        });\n      }\n\n      const {\n        method,\n        params\n      } = args;\n\n      if (typeof method !== \"string\" || method.length === 0) {\n        throw ethErrors.rpc.invalidRequest({\n          message: messages.errors.invalidRequestMethod(),\n          data: args\n        });\n      }\n\n      if (params !== undefined && !Array.isArray(params) && (typeof params !== \"object\" || params === null)) {\n        throw ethErrors.rpc.invalidRequest({\n          message: messages.errors.invalidRequestParams(),\n          data: args\n        });\n      }\n\n      return new Promise((resolve, reject) => {\n        this._rpcRequest({\n          method,\n          params\n        }, getRpcPromiseCallback(resolve, reject));\n      });\n    });\n  }\n  /**\n   * Submits an RPC request per the given JSON-RPC request object.\n   *\n   * @param {Object} payload - The RPC request object.\n   * @param {Function} cb - The callback function.\n   */\n\n\n  send(payload, callback) {\n    this._rpcRequest(payload, callback);\n  }\n  /**\n   * Submits an RPC request per the given JSON-RPC request object.\n   *\n   * @param {Object} payload - The RPC request object.\n   * @param {Function} cb - The callback function.\n   */\n\n\n  sendAsync(payload) {\n    return new Promise((resolve, reject) => {\n      this._rpcRequest(payload, getRpcPromiseCallback(resolve, reject));\n    });\n  }\n  /**\n   * Called when connection is lost to critical streams.\n   *\n   * @emits TorusInpageProvider#disconnect\n   */\n\n\n  _handleStreamDisconnect(streamName, error) {\n    logStreamDisconnectWarning(streamName, error, this);\n\n    this._handleDisconnect(false, error ? error.message : undefined);\n  }\n\n}\n\nconst handleEvent = (handle, eventName, handler, ...handlerArgs) => {\n  const handlerWrapper = () => {\n    handler(...handlerArgs);\n    handle.removeEventListener(eventName, handlerWrapper);\n  };\n\n  handle.addEventListener(eventName, handlerWrapper);\n};\n\nfunction documentReady() {\n  return __awaiter(this, void 0, void 0, function* () {\n    return new Promise(resolve => {\n      if (document.readyState !== \"loading\") {\n        resolve();\n      } else {\n        handleEvent(document, \"DOMContentLoaded\", resolve);\n      }\n    });\n  });\n}\n\nconst htmlToElement = html => {\n  const template = window.document.createElement(\"template\");\n  const trimmedHtml = html.trim(); // Never return a text node of whitespace as the result\n\n  template.innerHTML = trimmedHtml;\n  return template.content.firstChild;\n};\n\nclass PopupHandler extends SafeEventEmitter {\n  constructor({\n    url,\n    target,\n    features\n  }) {\n    super();\n    this.url = url;\n    this.target = target || \"_blank\";\n    this.features = features || getPopupFeatures(FEATURES_DEFAULT_POPUP_WINDOW);\n    this.window = undefined;\n    this.windowTimer = undefined;\n    this.iClosedWindow = false;\n\n    this._setupTimer();\n  }\n\n  _setupTimer() {\n    this.windowTimer = Number(setInterval(() => {\n      if (this.window && this.window.closed) {\n        clearInterval(this.windowTimer);\n\n        if (!this.iClosedWindow) {\n          this.emit(\"close\");\n        }\n\n        this.iClosedWindow = false;\n        this.window = undefined;\n      }\n\n      if (this.window === undefined) clearInterval(this.windowTimer);\n    }, 500));\n  }\n\n  open() {\n    var _a;\n\n    this.window = window.open(this.url.href, this.target, this.features);\n    if ((_a = this.window) === null || _a === void 0 ? void 0 : _a.focus) this.window.focus();\n    return Promise.resolve();\n  }\n\n  close() {\n    this.iClosedWindow = true;\n    if (this.window) this.window.close();\n  }\n\n  redirect(locationReplaceOnRedirect) {\n    if (locationReplaceOnRedirect) {\n      window.location.replace(this.url.href);\n    } else {\n      window.location.href = this.url.href;\n    }\n  }\n\n}\n/**\n * @param {Object} connectionStream - A Node.js duplex stream\n * @param {Object} opts - An options bag\n * @param {number} opts.maxEventListeners - The maximum number of event listeners\n */\n\n\nclass TorusCommunicationProvider extends BaseProvider {\n  constructor(connectionStream, {\n    maxEventListeners = 100,\n    jsonRpcStreamName = \"provider\"\n  }) {\n    super(connectionStream, {\n      maxEventListeners,\n      jsonRpcStreamName\n    }); // private state\n\n    this._state = Object.assign({}, TorusCommunicationProvider._defaultState); // public state\n\n    this.torusUrl = \"\";\n    this.dappStorageKey = \"\";\n    const languageTranslations = configuration.translations[getUserLanguage()];\n    this.embedTranslations = languageTranslations.embed;\n    this.windowRefs = {}; // setup own event listeners\n    // EIP-1193 connect\n\n    this.on(\"connect\", () => {\n      this._state.isConnected = true;\n    });\n\n    const notificationHandler = payload => {\n      const {\n        method,\n        params\n      } = payload;\n\n      if (method === COMMUNICATION_NOTIFICATIONS.IFRAME_STATUS) {\n        const {\n          isFullScreen,\n          rid\n        } = params;\n\n        this._displayIframe({\n          isFull: isFullScreen,\n          rid: rid\n        });\n      } else if (method === COMMUNICATION_NOTIFICATIONS.CREATE_WINDOW) {\n        const {\n          windowId,\n          url\n        } = params;\n\n        this._createPopupBlockAlert(windowId, url);\n      } else if (method === COMMUNICATION_NOTIFICATIONS.CLOSE_WINDOW) {\n        this._handleCloseWindow(params);\n      } else if (method === COMMUNICATION_NOTIFICATIONS.USER_LOGGED_IN) {\n        const {\n          currentLoginProvider\n        } = params;\n        this._state.isLoggedIn = true;\n        this._state.currentLoginProvider = currentLoginProvider;\n      } else if (method === COMMUNICATION_NOTIFICATIONS.USER_LOGGED_OUT) {\n        this._state.isLoggedIn = false;\n        this._state.currentLoginProvider = null;\n\n        this._displayIframe();\n      }\n    };\n\n    this.jsonRpcConnectionEvents.on(\"notification\", notificationHandler);\n  }\n  /**\n   * Returns whether the inPage provider is connected to Torus.\n   */\n\n\n  isConnected() {\n    return this._state.isConnected;\n  }\n\n  get isLoggedIn() {\n    return this._state.isLoggedIn;\n  }\n\n  get isIFrameFullScreen() {\n    return this._state.isIFrameFullScreen;\n  }\n\n  _initializeState(params) {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        const {\n          torusUrl,\n          dappStorageKey,\n          torusAlertContainer,\n          torusIframe\n        } = params;\n        this.torusUrl = torusUrl;\n        this.dappStorageKey = dappStorageKey;\n        this.torusAlertContainer = torusAlertContainer;\n        this.torusIframe = torusIframe;\n        this.torusIframe.addEventListener(\"load\", () => {\n          // only do this if iframe is not full screen\n          if (!this._state.isIFrameFullScreen) this._displayIframe();\n        });\n        const {\n          currentLoginProvider,\n          isLoggedIn\n        } = yield this.request({\n          method: COMMUNICATION_JRPC_METHODS.GET_PROVIDER_STATE,\n          params: []\n        }); // indicate that we've connected, for EIP-1193 compliance\n\n        this._handleConnect(currentLoginProvider, isLoggedIn);\n      } catch (error) {\n        log.error(\"Torus: Failed to get initial state. Please report this bug.\", error);\n      } finally {\n        log.info(\"initialized communication state\");\n        this._state.initialized = true;\n        this.emit(\"_initialized\");\n      }\n    });\n  }\n  /**\n   * Internal RPC method. Forwards requests to background via the RPC engine.\n   * Also remap ids inbound and outbound\n   */\n\n\n  _rpcRequest(payload, callback) {\n    const cb = callback;\n    const _payload = payload;\n\n    if (!Array.isArray(_payload)) {\n      if (!_payload.jsonrpc) {\n        _payload.jsonrpc = \"2.0\";\n      }\n    }\n\n    this.tryWindowHandle(_payload, cb);\n  }\n  /**\n   * When the provider becomes connected, updates internal state and emits\n   * required events. Idempotent.\n   *\n   * @param currentLoginProvider - The login Provider\n   * @emits TorusInpageProvider#connect\n   */\n\n\n  _handleConnect(currentLoginProvider, isLoggedIn) {\n    if (!this._state.isConnected) {\n      this._state.isConnected = true;\n      this.emit(\"connect\", {\n        currentLoginProvider,\n        isLoggedIn\n      });\n      log.debug(messages.info.connected(currentLoginProvider));\n    }\n  }\n  /**\n   * When the provider becomes disconnected, updates internal state and emits\n   * required events. Idempotent with respect to the isRecoverable parameter.\n   *\n   * Error codes per the CloseEvent status codes as required by EIP-1193:\n   * https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent#Status_codes\n   *\n   * @param isRecoverable - Whether the disconnection is recoverable.\n   * @param errorMessage - A custom error message.\n   * @emits TorusInpageProvider#disconnect\n   */\n\n\n  _handleDisconnect(isRecoverable, errorMessage) {\n    if (this._state.isConnected || !this._state.isPermanentlyDisconnected && !isRecoverable) {\n      this._state.isConnected = false;\n      let error;\n\n      if (isRecoverable) {\n        error = new EthereumRpcError(1013, // Try again later\n        errorMessage || messages.errors.disconnected());\n        log.debug(error);\n      } else {\n        error = new EthereumRpcError(1011, // Internal error\n        errorMessage || messages.errors.permanentlyDisconnected());\n        log.error(error);\n        this._state.currentLoginProvider = null;\n        this._state.isLoggedIn = false;\n        this._state.torusWidgetVisibility = true;\n        this._state.isIFrameFullScreen = false;\n        this._state.isPermanentlyDisconnected = true;\n      }\n\n      this.emit(\"disconnect\", error);\n    }\n  }\n\n  _handleWindow(windowId, {\n    url,\n    target,\n    features\n  } = {}) {\n    const finalUrl = new URL(url || `${this.torusUrl}/redirect?windowId=${windowId}`);\n\n    if (this.dappStorageKey) {\n      // If multiple instances, it returns the first one\n      if (finalUrl.hash) finalUrl.hash += `&dappStorageKey=${this.dappStorageKey}`;else finalUrl.hash = `#dappStorageKey=${this.dappStorageKey}`;\n    }\n\n    const handledWindow = new PopupHandler({\n      url: finalUrl,\n      target,\n      features\n    });\n    handledWindow.open();\n\n    if (!handledWindow.window) {\n      this._createPopupBlockAlert(windowId, finalUrl.href);\n\n      return;\n    } // Add to collection only if window is opened\n\n\n    this.windowRefs[windowId] = handledWindow; // We tell the iframe that the window has been successfully opened\n\n    this.request({\n      method: COMMUNICATION_JRPC_METHODS.OPENED_WINDOW,\n      params: {\n        windowId\n      }\n    });\n    handledWindow.once(\"close\", () => {\n      // user closed the window\n      delete this.windowRefs[windowId];\n      this.request({\n        method: COMMUNICATION_JRPC_METHODS.CLOSED_WINDOW,\n        params: {\n          windowId\n        }\n      });\n    });\n  } // Called if the iframe wants to close the window cause it is done processing the request\n\n\n  _handleCloseWindow(params) {\n    const {\n      windowId\n    } = params;\n\n    if (this.windowRefs[windowId]) {\n      this.windowRefs[windowId].close();\n      delete this.windowRefs[windowId];\n    }\n  }\n\n  _createPopupBlockAlert(windowId, url) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const logoUrl = this.getLogoUrl();\n      const torusAlert = htmlToElement('<div id=\"torusAlert\" class=\"torus-alert--v2\" style=\"display:block;\">' + `<div id=\"torusAlert__logo\"><img src=\"${logoUrl}\" /></div>` + \"<div>\" + `<h1 id=\"torusAlert__title\">${this.embedTranslations.actionRequired}</h1>` + `<p id=\"torusAlert__desc\">${this.embedTranslations.pendingAction}</p>` + \"</div>\" + \"</div>\");\n      const successAlert = htmlToElement(`<div><a id=\"torusAlert__btn\">${this.embedTranslations.continue}</a></div>`);\n      const btnContainer = htmlToElement('<div id=\"torusAlert__btn-container\"></div>');\n      btnContainer.appendChild(successAlert);\n      torusAlert.appendChild(btnContainer);\n\n      const bindOnLoad = () => {\n        successAlert.addEventListener(\"click\", () => {\n          this._handleWindow(windowId, {\n            url,\n            target: \"_blank\",\n            features: getPopupFeatures(FEATURES_CONFIRM_WINDOW)\n          });\n\n          torusAlert.remove();\n          if (this.torusAlertContainer.children.length === 0) this.torusAlertContainer.style.display = \"none\";\n        });\n      };\n\n      const attachOnLoad = () => {\n        this.torusAlertContainer.appendChild(torusAlert);\n      };\n\n      yield documentReady();\n      attachOnLoad();\n      bindOnLoad();\n    });\n  }\n\n  getLogoUrl() {\n    const logoUrl = `${this.torusUrl}/images/torus_icon-blue.svg`;\n    return logoUrl;\n  }\n\n  _displayIframe({\n    isFull = false,\n    rid = \"\"\n  } = {}) {\n    const style = {}; // set phase\n\n    if (!isFull) {\n      style.display = this._state.torusWidgetVisibility ? \"block\" : \"none\";\n      style.height = \"70px\";\n      style.width = \"70px\";\n\n      switch (this._state.buttonPosition) {\n        case BUTTON_POSITION.TOP_LEFT:\n          style.top = \"0px\";\n          style.left = \"0px\";\n          style.right = \"auto\";\n          style.bottom = \"auto\";\n          break;\n\n        case BUTTON_POSITION.TOP_RIGHT:\n          style.top = \"0px\";\n          style.right = \"0px\";\n          style.left = \"auto\";\n          style.bottom = \"auto\";\n          break;\n\n        case BUTTON_POSITION.BOTTOM_RIGHT:\n          style.bottom = \"0px\";\n          style.right = \"0px\";\n          style.top = \"auto\";\n          style.left = \"auto\";\n          break;\n\n        case BUTTON_POSITION.BOTTOM_LEFT:\n        default:\n          style.bottom = \"0px\";\n          style.left = \"0px\";\n          style.top = \"auto\";\n          style.right = \"auto\";\n          break;\n      }\n    } else {\n      style.display = \"block\";\n      style.width = \"100%\";\n      style.height = \"100%\";\n      style.top = \"0px\";\n      style.right = \"0px\";\n      style.left = \"0px\";\n      style.bottom = \"0px\";\n    }\n\n    Object.assign(this.torusIframe.style, style);\n    this._state.isIFrameFullScreen = isFull;\n    this.request({\n      method: COMMUNICATION_JRPC_METHODS.IFRAME_STATUS,\n      params: {\n        isIFrameFullScreen: isFull,\n        rid\n      }\n    });\n  }\n\n  hideTorusButton() {\n    this._state.torusWidgetVisibility = false;\n\n    this._displayIframe();\n  }\n\n  showTorusButton() {\n    this._state.torusWidgetVisibility = true;\n\n    this._displayIframe();\n  }\n\n}\n\nTorusCommunicationProvider._defaultState = {\n  buttonPosition: \"bottom-left\",\n  currentLoginProvider: null,\n  isIFrameFullScreen: false,\n  hasEmittedConnection: false,\n  torusWidgetVisibility: true,\n  initialized: false,\n  isLoggedIn: false,\n  isPermanentlyDisconnected: false,\n  isConnected: false\n};\n/**\n * @param {Object} connectionStream - A Node.js duplex stream\n * @param {Object} opts - An options bag\n * @param {number} opts.maxEventListeners - The maximum number of event listeners\n */\n\nclass TorusInPageProvider extends BaseProvider {\n  constructor(connectionStream, {\n    maxEventListeners = 100,\n    jsonRpcStreamName = \"provider\"\n  }) {\n    super(connectionStream, {\n      maxEventListeners,\n      jsonRpcStreamName\n    }); // private state\n\n    this._state = Object.assign({}, TorusInPageProvider._defaultState); // public state\n\n    this.selectedAddress = null;\n    this.chainId = null;\n    this._handleAccountsChanged = this._handleAccountsChanged.bind(this);\n    this._handleChainChanged = this._handleChainChanged.bind(this);\n    this._handleUnlockStateChanged = this._handleUnlockStateChanged.bind(this); // setup own event listeners\n    // EIP-1193 connect\n\n    this.on(\"connect\", () => {\n      this._state.isConnected = true;\n    });\n\n    const jsonRpcNotificationHandler = payload => {\n      const {\n        method,\n        params\n      } = payload;\n\n      if (method === PROVIDER_NOTIFICATIONS.ACCOUNTS_CHANGED) {\n        this._handleAccountsChanged(params);\n      } else if (method === PROVIDER_NOTIFICATIONS.UNLOCK_STATE_CHANGED) {\n        this._handleUnlockStateChanged(params);\n      } else if (method === PROVIDER_NOTIFICATIONS.CHAIN_CHANGED) {\n        this._handleChainChanged(params);\n      }\n    }; // json rpc notification listener\n\n\n    this.jsonRpcConnectionEvents.on(\"notification\", jsonRpcNotificationHandler);\n  }\n  /**\n   * Returns whether the inpage provider is connected to Torus.\n   */\n\n\n  isConnected() {\n    return this._state.isConnected;\n  } // Private Methods\n  //= ===================\n\n  /**\n   * Constructor helper.\n   * Populates initial state by calling 'wallet_getProviderState' and emits\n   * necessary events.\n   */\n\n\n  _initializeState() {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        const {\n          accounts,\n          chainId,\n          isUnlocked\n        } = yield this.request({\n          method: PROVIDER_JRPC_METHODS.GET_PROVIDER_STATE,\n          params: []\n        }); // indicate that we've connected, for EIP-1193 compliance\n\n        this.emit(\"connect\", {\n          chainId\n        });\n\n        this._handleChainChanged({\n          chainId\n        });\n\n        this._handleUnlockStateChanged({\n          accounts,\n          isUnlocked\n        });\n\n        this._handleAccountsChanged(accounts);\n      } catch (error) {\n        log.error(\"Torus: Failed to get initial state. Please report this bug.\", error);\n      } finally {\n        log.info(\"initialized provider state\");\n        this._state.initialized = true;\n        this.emit(\"_initialized\");\n      }\n    });\n  }\n  /**\n   * Internal RPC method. Forwards requests to background via the RPC engine.\n   * Also remap ids inbound and outbound\n   */\n\n\n  _rpcRequest(payload, callback, isInternal = false) {\n    let cb = callback;\n    const _payload = payload;\n\n    if (!Array.isArray(_payload)) {\n      if (!_payload.jsonrpc) {\n        _payload.jsonrpc = \"2.0\";\n      }\n\n      if (_payload.method === \"solana_accounts\" || _payload.method === \"solana_requestAccounts\") {\n        // handle accounts changing\n        cb = (err, res) => {\n          this._handleAccountsChanged(res.result || [], _payload.method === \"solana_accounts\", isInternal);\n\n          callback(err, res);\n        };\n      } else if (_payload.method === \"wallet_getProviderState\") {\n        this._rpcEngine.handle(payload, cb);\n\n        return;\n      }\n    }\n\n    this.tryWindowHandle(_payload, cb);\n  }\n  /**\n   * When the provider becomes connected, updates internal state and emits\n   * required events. Idempotent.\n   *\n   * @param chainId - The ID of the newly connected chain.\n   * @emits TorusInpageProvider#connect\n   */\n\n\n  _handleConnect(chainId) {\n    if (!this._state.isConnected) {\n      this._state.isConnected = true;\n      this.emit(\"connect\", {\n        chainId\n      });\n      log.debug(messages.info.connected(chainId));\n    }\n  }\n  /**\n   * When the provider becomes disconnected, updates internal state and emits\n   * required events. Idempotent with respect to the isRecoverable parameter.\n   *\n   * Error codes per the CloseEvent status codes as required by EIP-1193:\n   * https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent#Status_codes\n   *\n   * @param isRecoverable - Whether the disconnection is recoverable.\n   * @param errorMessage - A custom error message.\n   * @emits TorusInpageProvider#disconnect\n   */\n\n\n  _handleDisconnect(isRecoverable, errorMessage) {\n    if (this._state.isConnected || !this._state.isPermanentlyDisconnected && !isRecoverable) {\n      this._state.isConnected = false;\n      let error;\n\n      if (isRecoverable) {\n        error = new EthereumRpcError(1013, // Try again later\n        errorMessage || messages.errors.disconnected());\n        log.debug(error);\n      } else {\n        error = new EthereumRpcError(1011, // Internal error\n        errorMessage || messages.errors.permanentlyDisconnected());\n        log.error(error);\n        this.chainId = null;\n        this._state.accounts = null;\n        this.selectedAddress = null;\n        this._state.isUnlocked = false;\n        this._state.isPermanentlyDisconnected = true;\n      }\n\n      this.emit(\"disconnect\", error);\n    }\n  }\n  /**\n   * Called when accounts may have changed.\n   */\n\n\n  _handleAccountsChanged(accounts, isEthAccounts = false, isInternal = false) {\n    // defensive programming\n    let finalAccounts = accounts;\n\n    if (!Array.isArray(finalAccounts)) {\n      log.error(\"Torus: Received non-array accounts parameter. Please report this bug.\", finalAccounts);\n      finalAccounts = [];\n    }\n\n    for (const account of accounts) {\n      if (typeof account !== \"string\") {\n        log.error(\"Torus: Received non-string account. Please report this bug.\", accounts);\n        finalAccounts = [];\n        break;\n      }\n    } // emit accountsChanged if anything about the accounts array has changed\n\n\n    if (!dequal(this._state.accounts, finalAccounts)) {\n      // we should always have the correct accounts even before solana_accounts\n      // returns, except in cases where isInternal is true\n      if (isEthAccounts && Array.isArray(this._state.accounts) && this._state.accounts.length > 0 && !isInternal) {\n        log.error('Torus: \"solana_accounts\" unexpectedly updated accounts. Please report this bug.', finalAccounts);\n      }\n\n      this._state.accounts = finalAccounts;\n      this.emit(\"accountsChanged\", finalAccounts);\n    } // handle selectedAddress\n\n\n    if (this.selectedAddress !== finalAccounts[0]) {\n      this.selectedAddress = finalAccounts[0] || null;\n    }\n  }\n  /**\n   * Upon receipt of a new chainId and networkVersion, emits corresponding\n   * events and sets relevant public state.\n   * Does nothing if neither the chainId nor the networkVersion are different\n   * from existing values.\n   *\n   * @emits TorusInpageProvider#chainChanged\n   * @param networkInfo - An object with network info.\n   * @param networkInfo.chainId - The latest chain ID.\n   * @param networkInfo.networkVersion - The latest network ID.\n   */\n\n\n  _handleChainChanged({\n    chainId\n  } = {}) {\n    if (!chainId) {\n      log.error(\"Torus: Received invalid network parameters. Please report this bug.\", {\n        chainId\n      });\n      return;\n    }\n\n    if (chainId === \"loading\") {\n      this._handleDisconnect(true);\n    } else {\n      this._handleConnect(chainId);\n\n      if (chainId !== this.chainId) {\n        this.chainId = chainId;\n\n        if (this._state.initialized) {\n          this.emit(\"chainChanged\", this.chainId);\n        }\n      }\n    }\n  }\n  /**\n   * Upon receipt of a new isUnlocked state, sets relevant public state.\n   * Calls the accounts changed handler with the received accounts, or an empty\n   * array.\n   *\n   * Does nothing if the received value is equal to the existing value.\n   * There are no lock/unlock events.\n   *\n   * @param opts - Options bag.\n   * @param opts.accounts - The exposed accounts, if any.\n   * @param opts.isUnlocked - The latest isUnlocked value.\n   */\n\n\n  _handleUnlockStateChanged({\n    accounts,\n    isUnlocked\n  } = {}) {\n    if (typeof isUnlocked !== \"boolean\") {\n      log.error(\"Torus: Received invalid isUnlocked parameter. Please report this bug.\", {\n        isUnlocked\n      });\n      return;\n    }\n\n    if (isUnlocked !== this._state.isUnlocked) {\n      this._state.isUnlocked = isUnlocked;\n\n      this._handleAccountsChanged(accounts || []);\n    }\n  }\n\n}\n\nTorusInPageProvider._defaultState = {\n  accounts: null,\n  isConnected: false,\n  isUnlocked: false,\n  initialized: false,\n  isPermanentlyDisconnected: false,\n  hasEmittedConnection: false\n};\n/**\n * Returns whether the given image URL exists\n * @param {string} url - the url of the image\n * @return {Promise<boolean>} whether the image exists\n */\n\nfunction imgExists(url) {\n  return new Promise((resolve, reject) => {\n    try {\n      const img = document.createElement(\"img\");\n\n      img.onload = () => resolve(true);\n\n      img.onerror = () => resolve(false);\n\n      img.src = url;\n    } catch (e) {\n      reject(e);\n    }\n  });\n}\n/**\n * Extracts a name for the site from the DOM\n */\n\n\nconst getSiteName = window => {\n  const {\n    document\n  } = window;\n  const siteName = document.querySelector('head > meta[property=\"og:site_name\"]');\n\n  if (siteName) {\n    return siteName.content;\n  }\n\n  const metaTitle = document.querySelector('head > meta[name=\"title\"]');\n\n  if (metaTitle) {\n    return metaTitle.content;\n  }\n\n  if (document.title && document.title.length > 0) {\n    return document.title;\n  }\n\n  return window.location.hostname;\n};\n/**\n * Extracts an icon for the site from the DOM\n */\n\n\nfunction getSiteIcon(window) {\n  return __awaiter(this, void 0, void 0, function* () {\n    try {\n      const {\n        document\n      } = window; // Use the site's favicon if it exists\n\n      let icon = document.querySelector('head > link[rel=\"shortcut icon\"]');\n\n      if (icon && (yield imgExists(icon.href))) {\n        return icon.href;\n      } // Search through available icons in no particular order\n\n\n      icon = Array.from(document.querySelectorAll('head > link[rel=\"icon\"]')).find(_icon => Boolean(_icon.href));\n\n      if (icon && (yield imgExists(icon.href))) {\n        return icon.href;\n      }\n\n      return \"\";\n    } catch (error) {\n      return \"\";\n    }\n  });\n}\n/**\n * Gets site metadata and returns it\n *\n */\n\n\nconst getSiteMetadata = () => __awaiter(void 0, void 0, void 0, function* () {\n  return {\n    name: getSiteName(window),\n    icon: yield getSiteIcon(window)\n  };\n});\n\nconst PROVIDER_UNSAFE_METHODS = [\"send_transaction\", \"sign_transaction\", \"sign_all_transaction\", \"sign_message\", \"connect\"];\nconst COMMUNICATION_UNSAFE_METHODS = [COMMUNICATION_JRPC_METHODS.SET_PROVIDER];\nconst isLocalStorageAvailable = storageAvailable(\"localStorage\"); // preload for iframe doesn't work https://bugs.chromium.org/p/chromium/issues/detail?id=593267\n\n(function preLoadIframe() {\n  return __awaiter(this, void 0, void 0, function* () {\n    try {\n      if (typeof document === \"undefined\") return;\n      const torusIframeHtml = document.createElement(\"link\");\n      const {\n        torusUrl\n      } = yield getTorusUrl(\"production\");\n      torusIframeHtml.href = `${torusUrl}/frame`;\n      torusIframeHtml.crossOrigin = \"anonymous\";\n      torusIframeHtml.type = \"text/html\";\n      torusIframeHtml.rel = \"prefetch\";\n\n      if (torusIframeHtml.relList && torusIframeHtml.relList.supports) {\n        if (torusIframeHtml.relList.supports(\"prefetch\")) {\n          document.head.appendChild(torusIframeHtml);\n        }\n      }\n    } catch (error) {\n      log.warn(error);\n    }\n  });\n})();\n\nclass Torus {\n  constructor({\n    modalZIndex = 99999\n  } = {}) {\n    this.torusUrl = \"\";\n    this.isInitialized = false; // init done\n\n    this.requestedLoginProvider = null;\n    this.modalZIndex = modalZIndex;\n    this.alertZIndex = modalZIndex + 1000;\n    this.dappStorageKey = \"\";\n  }\n\n  get isLoggedIn() {\n    if (!this.communicationProvider) return false;\n    return this.communicationProvider.isLoggedIn;\n  }\n\n  init({\n    buildEnv = TORUS_BUILD_ENV.PRODUCTION,\n    enableLogging = false,\n    network,\n    showTorusButton = true,\n    useLocalStorage = false,\n    buttonPosition = BUTTON_POSITION.BOTTOM_LEFT,\n    apiKey = \"torus-default\",\n    extraParams = {}\n  } = {}) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this.isInitialized) throw new Error(\"Already initialized\");\n      setAPIKey(apiKey);\n      const {\n        torusUrl,\n        logLevel\n      } = yield getTorusUrl(buildEnv);\n      log.info(torusUrl, \"url loaded\");\n      this.torusUrl = torusUrl;\n      log.setDefaultLevel(logLevel);\n      if (enableLogging) log.enableAll();else log.disableAll();\n      const dappStorageKey = this.handleDappStorageKey(useLocalStorage);\n      const torusIframeUrl = new URL(torusUrl);\n      if (torusIframeUrl.pathname.endsWith(\"/\")) torusIframeUrl.pathname += \"frame\";else torusIframeUrl.pathname += \"/frame\";\n      const hashParams = new URLSearchParams();\n      if (dappStorageKey) hashParams.append(\"dappStorageKey\", dappStorageKey);\n      hashParams.append(\"origin\", window.location.origin);\n      torusIframeUrl.hash = hashParams.toString(); // Iframe code\n\n      this.torusIframe = htmlToElement(`<iframe\n        id=\"torusIframe\"\n        class=\"torusIframe\"\n        src=\"${torusIframeUrl.href}\"\n        style=\"display: none; position: fixed; top: 0; right: 0; width: 100%;\n        height: 100%; border: none; border-radius: 0; z-index: ${this.modalZIndex.toString()}\"\n      ></iframe>`);\n      this.torusAlertContainer = htmlToElement(`<div id=\"torusAlertContainer style=\"display:none; z-index: ${this.alertZIndex.toString()}\"></div>`);\n      this.styleLink = htmlToElement(`<link href=\"${torusUrl}/css/widget.css\" rel=\"stylesheet\" type=\"text/css\">`);\n\n      const handleSetup = () => __awaiter(this, void 0, void 0, function* () {\n        window.document.head.appendChild(this.styleLink);\n        window.document.body.appendChild(this.torusIframe);\n        window.document.body.appendChild(this.torusAlertContainer);\n        this.torusIframe.addEventListener(\"load\", () => __awaiter(this, void 0, void 0, function* () {\n          const dappMetadata = yield getSiteMetadata(); // send init params here\n\n          this.torusIframe.contentWindow.postMessage({\n            buttonPosition,\n            apiKey,\n            network,\n            dappMetadata,\n            extraParams\n          }, torusIframeUrl.origin);\n        }));\n        yield this._setupWeb3({\n          torusUrl\n        });\n        if (showTorusButton) this.showTorusButton();else this.hideTorusButton();\n        this.isInitialized = true;\n        window.torus = this;\n      });\n\n      yield documentReady();\n      yield handleSetup();\n    });\n  }\n\n  handleDappStorageKey(useLocalStorage) {\n    let dappStorageKey = \"\";\n\n    if (isLocalStorageAvailable && useLocalStorage) {\n      const storedKey = window.localStorage.getItem(configuration.localStorageKey);\n      if (storedKey) dappStorageKey = storedKey;else {\n        const generatedKey = `torus-app-${getWindowId()}`;\n        window.localStorage.setItem(configuration.localStorageKey, generatedKey);\n        dappStorageKey = generatedKey;\n      }\n    }\n\n    this.dappStorageKey = dappStorageKey;\n    return dappStorageKey;\n  }\n\n  login(params = {}) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!this.isInitialized) throw new Error(\"Call init() first\");\n\n      try {\n        this.requestedLoginProvider = params.loginProvider || null;\n        const reqParams = {};\n\n        if (this.requestedLoginProvider) {\n          reqParams.requestedLoginProvider = this.requestedLoginProvider;\n          reqParams.windowId = getWindowId();\n\n          this.communicationProvider._handleWindow(reqParams.windowId);\n        } else {\n          this.communicationProvider._displayIframe({\n            isFull: true\n          });\n        } // If user is already logged in, we assume they have given access to the website\n\n\n        const res = yield new Promise((resolve, reject) => {\n          // We use this method because we want to update inPage provider state with account info\n          this.provider._rpcRequest({\n            method: \"solana_requestAccounts\",\n            params: [this.requestedLoginProvider, params.login_hint]\n          }, getRpcPromiseCallback(resolve, reject));\n        });\n\n        if (Array.isArray(res) && res.length > 0) {\n          return res;\n        } // This would never happen, but just in case\n\n\n        throw new Error(\"Login failed\");\n      } catch (error) {\n        log.error(\"login failed\", error);\n        throw error;\n      } finally {\n        if (this.communicationProvider.isIFrameFullScreen) this.communicationProvider._displayIframe();\n      }\n    });\n  }\n\n  logout() {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!this.communicationProvider.isLoggedIn) throw new Error(\"Not logged in\");\n      yield this.communicationProvider.request({\n        method: COMMUNICATION_JRPC_METHODS.LOGOUT,\n        params: []\n      });\n      this.requestedLoginProvider = null;\n    });\n  }\n\n  cleanUp() {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this.communicationProvider.isLoggedIn) {\n        yield this.logout();\n      }\n\n      this.clearInit();\n    });\n  }\n\n  clearInit() {\n    function isElement(element) {\n      return element instanceof Element || element instanceof Document;\n    }\n\n    if (isElement(this.styleLink) && window.document.body.contains(this.styleLink)) {\n      this.styleLink.remove();\n      this.styleLink = undefined;\n    }\n\n    if (isElement(this.torusIframe) && window.document.body.contains(this.torusIframe)) {\n      this.torusIframe.remove();\n      this.torusIframe = undefined;\n    }\n\n    if (isElement(this.torusAlertContainer) && window.document.body.contains(this.torusAlertContainer)) {\n      this.torusAlert = undefined;\n      this.torusAlertContainer.remove();\n      this.torusAlertContainer = undefined;\n    }\n\n    this.isInitialized = false;\n  }\n\n  hideTorusButton() {\n    this.communicationProvider.hideTorusButton();\n  }\n\n  showTorusButton() {\n    this.communicationProvider.showTorusButton();\n  }\n  /** @ignore */\n\n  /** @ignore */\n\n\n  _setupWeb3(providerParams) {\n    return __awaiter(this, void 0, void 0, function* () {\n      log.info(\"setupWeb3 running\"); // setup background connection\n\n      const providerStream = new BasePostMessageStream({\n        name: \"embed_torus\",\n        target: \"iframe_torus\",\n        targetWindow: this.torusIframe.contentWindow,\n        targetOrigin: providerParams.torusUrl\n      }); // We create another LocalMessageDuplexStream for communication between dapp <> iframe\n\n      const communicationStream = new BasePostMessageStream({\n        name: \"embed_communication\",\n        target: \"iframe_communication\",\n        targetWindow: this.torusIframe.contentWindow,\n        targetOrigin: providerParams.torusUrl\n      }); // compose the inPage provider\n\n      const inPageProvider = new TorusInPageProvider(providerStream, {});\n      const communicationProvider = new TorusCommunicationProvider(communicationStream, {});\n\n      inPageProvider.tryWindowHandle = (payload, cb) => {\n        const _payload = payload;\n\n        if (!Array.isArray(_payload) && PROVIDER_UNSAFE_METHODS.includes(_payload.method)) {\n          if (!this.communicationProvider.isLoggedIn) throw new Error(\"User Not Logged In\");\n          const windowId = getWindowId();\n\n          communicationProvider._handleWindow(windowId, {\n            target: \"_blank\",\n            features: getPopupFeatures(FEATURES_CONFIRM_WINDOW)\n          }); // for inPageProvider methods sending windowId in request instead of params\n          // as params might be positional.\n\n\n          _payload.windowId = windowId;\n        }\n\n        inPageProvider._rpcEngine.handle(_payload, cb);\n      };\n\n      communicationProvider.tryWindowHandle = (payload, cb) => {\n        const _payload = payload;\n\n        if (!Array.isArray(_payload) && COMMUNICATION_UNSAFE_METHODS.includes(_payload.method)) {\n          const windowId = getWindowId();\n\n          communicationProvider._handleWindow(windowId, {\n            target: \"_blank\",\n            features: getPopupFeatures(FEATURES_PROVIDER_CHANGE_WINDOW) // todo: are these features generic for all\n\n          }); // for communication methods sending window id in jrpc req params\n\n\n          _payload.params.windowId = windowId;\n        }\n\n        communicationProvider._rpcEngine.handle(_payload, cb);\n      }; // detect solana_requestAccounts and pipe to enable for now\n\n\n      const detectAccountRequestPrototypeModifier = m => {\n        const originalMethod = inPageProvider[m];\n        const self = this;\n\n        inPageProvider[m] = function providerFunc(request, cb) {\n          const {\n            method,\n            params = []\n          } = request;\n\n          if (method === \"solana_requestAccounts\") {\n            if (!cb) return self.login({\n              loginProvider: params[0]\n            });\n            self.login({\n              loginProvider: params[0]\n            }) // eslint-disable-next-line promise/no-callback-in-promise\n            .then(res => cb(null, res)) // eslint-disable-next-line promise/no-callback-in-promise\n            .catch(err => cb(err));\n          }\n\n          return originalMethod.apply(this, [request, cb]);\n        };\n      }; // Detects call to solana_requestAccounts in request & sendAsync and passes to login\n\n\n      detectAccountRequestPrototypeModifier(\"request\");\n      detectAccountRequestPrototypeModifier(\"sendAsync\");\n      detectAccountRequestPrototypeModifier(\"send\");\n      const proxiedInPageProvider = new Proxy(inPageProvider, {\n        // straight up lie that we deleted the property so that it doesn't\n        // throw an error in strict mode\n        deleteProperty: () => true\n      });\n      const proxiedCommunicationProvider = new Proxy(communicationProvider, {\n        // straight up lie that we deleted the property so that it doesn't\n        // throw an error in strict mode\n        deleteProperty: () => true\n      });\n      this.provider = proxiedInPageProvider;\n      this.communicationProvider = proxiedCommunicationProvider;\n      yield Promise.all([inPageProvider._initializeState(), communicationProvider._initializeState(Object.assign(Object.assign({}, providerParams), {\n        dappStorageKey: this.dappStorageKey,\n        torusAlertContainer: this.torusAlertContainer,\n        torusIframe: this.torusIframe\n      }))]);\n      log.debug(\"Torus - injected provider\");\n    });\n  }\n\n  setProvider(params) {\n    return __awaiter(this, void 0, void 0, function* () {\n      yield this.communicationProvider.request({\n        method: COMMUNICATION_JRPC_METHODS.SET_PROVIDER,\n        params: Object.assign({}, params)\n      });\n    });\n  }\n\n  showWallet(path, params = {}) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const instanceId = yield this.communicationProvider.request({\n        method: COMMUNICATION_JRPC_METHODS.WALLET_INSTANCE_ID,\n        params: []\n      });\n      const finalPath = path ? `/${path}` : \"\";\n      const finalUrl = new URL(`${this.torusUrl}/wallet${finalPath}`); // Using URL constructor to prevent js injection and allow parameter validation.!\n\n      finalUrl.searchParams.append(\"instanceId\", instanceId);\n      Object.keys(params).forEach(x => {\n        finalUrl.searchParams.append(x, params[x]);\n      });\n\n      if (this.dappStorageKey) {\n        finalUrl.hash = `#dappStorageKey=${this.dappStorageKey}`;\n      } // No need to track this window state. Hence, no _handleWindow call.\n\n\n      const walletWindow = new PopupHandler({\n        url: finalUrl,\n        features: getPopupFeatures(FEATURES_DEFAULT_WALLET_WINDOW)\n      });\n      walletWindow.open();\n    });\n  }\n\n  getUserInfo() {\n    return __awaiter(this, void 0, void 0, function* () {\n      const userInfoResponse = yield this.communicationProvider.request({\n        method: COMMUNICATION_JRPC_METHODS.USER_INFO,\n        params: []\n      });\n      return userInfoResponse;\n    });\n  }\n\n  initiateTopup(provider, params) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!this.isInitialized) throw new Error(\"Torus is not initialized\");\n      const windowId = getWindowId();\n\n      this.communicationProvider._handleWindow(windowId);\n\n      const topupResponse = yield this.communicationProvider.request({\n        method: COMMUNICATION_JRPC_METHODS.TOPUP,\n        params: {\n          provider,\n          params,\n          windowId\n        }\n      });\n      return topupResponse;\n    });\n  } // Solana specific API\n\n\n  sendTransaction(transaction) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const response = yield this.provider.request({\n        method: \"send_transaction\",\n        params: {\n          message: transaction.serializeMessage().toString(\"hex\")\n        }\n      });\n      return response;\n    });\n  }\n\n  signTransaction(transaction) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const response = yield this.provider.request({\n        method: \"sign_transaction\",\n        params: {\n          message: transaction.serializeMessage().toString(\"hex\")\n        }\n      });\n      const buf = Buffer.from(response, \"hex\");\n      const sendTx = Transaction.from(buf);\n      return sendTx;\n    });\n  }\n\n  signAllTransactions(transactions) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const signed_transactions = [];\n\n      for (const transaction of transactions) {\n        const res = yield this.signTransaction(transaction);\n        signed_transactions.push(res);\n      }\n\n      return signed_transactions;\n    });\n  }\n\n  signMessage(data) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const response = yield this.provider.request({\n        method: \"sign_message\",\n        params: {\n          data\n        }\n      });\n      return response;\n    });\n  }\n\n  getGaslessPublicKey() {\n    return __awaiter(this, void 0, void 0, function* () {\n      const response = yield this.provider.request({\n        method: \"get_gasless_public_key\",\n        params: []\n      });\n      return response;\n    });\n  }\n\n}\n\nexport { BUTTON_POSITION, LOGIN_PROVIDER, PAYMENT_PROVIDER, TORUS_BUILD_ENV, TorusInPageProvider, Torus as default };","map":{"version":3,"sources":["../node_modules/tslib/tslib.es6.js","../src/messages.ts","../src/interfaces.ts","../src/config.ts","../src/loglevel.ts","../src/utils.ts","../src/baseProvider.ts","../src/embedUtils.ts","../src/PopupHandler.ts","../src/communicationProvider.ts","../src/inPageProvider.ts","../src/siteMetadata.ts","../src/embed.ts"],"names":["config"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n",null,null,null,null,null,null,null,null,null,null,null,null]},"metadata":{},"sourceType":"module"}